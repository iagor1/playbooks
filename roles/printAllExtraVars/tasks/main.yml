---
- name: Mostra TUDO que foi passado via extra vars
  ansible.builtin.set_fact:
    # msg: "{{ vars }} | map(attribute='stage')"
    # msg: " {{ vars | dict2items | selectattr('key', 'endswith', '_image') | list }}"
    service_name: " {{ vars | dict2items | selectattr('key', 'match', '.*_image$') | map(attribute='key') | first }}"
      # msg: "{{ vars | dict2items | selectattr('key', 'endswith', '_image') | map(attribute='value') | first }}"
      # msg: "{{ vars | dict2items | selectattr('key', 'endswith', '_image') | map(attribute='value') }}"
    image_tag: " {{ vars | dict2items | selectattr('key', 'match', '.*_image$') | map(attribute='value') | first }}"

- name: Print Image Tag
  ansible.builtin.debug:
    msg: "Image Tag: {{ image_tag }}"

- name: Print Image Tag
  ansible.builtin.debug:
    msg: "Image Tag: {{ service_name }}"
  when: "'stage-3' in stage or 'hotfix' in stage"

# - name: Deploy
#   ansible.legacy.shell:
#     cmd: "echo {{ image_tag }}"
